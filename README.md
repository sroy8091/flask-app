## Dependencies

You will need [docker](https://docs.docker.com/engine/installation/) and [docker-compose](https://docs.docker.com/compose/install/).

## Getting Started

```bash
$ make server.install      # Install the pip dependencies on the docker container
$ make database.upgrade    # Wait till all db containers are up. Upgrade the database, this will populate data from sample json to the database and es
$ make server.start        # Run the container containing your local python server
```

## Database

```bash
$ make database.connect
```

## Testing

```bash
$ make test
$ make test.coverage      # Generate a coverage report, threshold is 95%
```

## Application Structure

```
├── migrations               # Database's migrations settings
│   └── versions             # Database's migrations versions generated by alembic
├── src                      # Application source code
│   ├── models               # Python classes modeling the database
│   ├── routes               # Routes definitions and links to their associated resources
│   ├── util                 # Some helpfull, non-business Python functions for your project
│   ├── config.py            # Project configuration settings
│   ├── manage.py            # Project commands
│   └── server.py            # Server configuration
└── test                     # Unit tests source code
```

## API Endpoints

### POST api/v1/register

**Parameters**

|       Name | Required |  Type   | Description           |
|-----------:|:--------:|:-------:|-----------------------|
| `username` | required | string  | Username              |
| `password` | required | string  | Password              |
| `is_admin` | optional | boolean | New user admin or not |

**Response**

```
{
    "message": "Registration successful."
}

or any implemented error

{
    "message": "Invalid username or password."
}
```
___

### POST /api/v1/login

**Parameters**

|       Name | Required |  Type   | Description |
|-----------:|:--------:|:-------:|-------------|
| `username` | required | string  | Username    |
| `password` | required | string  | Password    |

**Response**

```
{
    "message": "Login successful.",
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFiYyIsImV4cCI6MTY0MjQxNjA2NH0.a1Dv7mUdfVzySuASTXYAEQC0mR5X2k5v9HeS2WU9bU8"
}

or any implemented error

{
    "message": "Invalid username or password."
}
```
___

### POST /ap1/v1/add_movie

**Parameters**

|         Name | Required |  Type  | Description   |
|-------------:|:--------:|:------:|---------------|
|       `name` | required | string | name of movie |
| `imdb_score` | required | float  | imdb rating   |
|   `director` | required | string | director      |
| `popularity` | optional | float  | popularity    |
|      `genre` | optional |  list  | genre list    |
**Response**

```
{
    "message": "Movie added successfully"
}

or any implemented error

{
    "message": "Movie already exists"
}

{
    "message": "Genre not found"
}
```
___

### POST /api/v1/search_movie

**Parameters**

|          Name | Required |  Type   | Description                                |
|--------------:|:--------:|:-------:|--------------------------------------------|
|        `name` | required | string  | String to search in movie name or director |
**Response**

```
{
    "message": "Movie found",
    "movies": [
        {
            "director": "Victor Fleming",
            "genres": [
                {
                    "title": " Fantasy"
                },
                {
                    "title": " Musical"
                },
                {
                    "title": " Family"
                },
                {
                    "title": "Adventure"
                }
            ],
            "imdb_score": 8.3,
            "name": "The Wizard of Oz",
            "popularity": 83.0
        }
    ]
}

or any implemented error

{
    "message": "Movie not found"
}
```

# Scaling Plans
Major API's that will be used:
- /api/v1/register
- /api/v1/login
- /api/v1/search_movie

### Login Scaling
- Currently, login is very lean, it just contains username and password.
- We can think of adding a token table as well to enhance security of token and expire them with a logout function.
- We can add a refresh token and API to generate a new token.
- We can add an index on username to improve performance.

### Register Scaling
- Currently, register is very lean, it just contains username, password and admin
- To enhance security we can add a check that only admin users can create more admin users.

### Search Scaling
- Currently, we do fuzzy search on name and director fields we can add more fields.
- To achieve more search capabilities we can scale up elasticsearch.
- We can add a redis layer to store top 10 results(based on filters) and cache them for a period of time.

### General Scaling
- Adding load balancer to improve performance.
- Moving insert queries to a background task whenever possible.
- Adding a cache layer to improve fetch performance.
